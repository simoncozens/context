<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Simple WASM Test (No Worker)</title>
</head>
<body>
    <h1>Direct WASM Test</h1>
    <button id="test">Test Compilation</button>
    <pre id="log"></pre>

    <script type="module">
        import init, { compile_babelfont, version } from './wasm-dist/babelfont_fontc_web.js';

        const log = document.getElementById('log');
        function addLog(msg) {
            console.log(msg);
            log.textContent += msg + '\n';
        }

        document.getElementById('test').addEventListener('click', async () => {
            try {
                addLog('1. Initializing WASM...');
                await init();
                addLog('2. WASM initialized: ' + version());
                
                addLog('3. Loading test font...');
                const response = await fetch('examples/Fustat.babelfont');
                const json = await response.text();
                addLog('4. Loaded ' + (json.length / 1024).toFixed(1) + ' KB');
                
                addLog('5. Starting compilation...');
                const start = Date.now();
                const ttf = compile_babelfont(json);
                const duration = Date.now() - start;
                
                addLog('6. SUCCESS! Compiled in ' + duration + 'ms');
                addLog('   Output: ' + (ttf.length / 1024).toFixed(1) + ' KB');
            } catch (e) {
                addLog('ERROR: ' + e.message);
                console.error(e);
            }
        });
    </script>
</body>
</html>
